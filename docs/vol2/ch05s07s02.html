<?xml version="1.0" encoding="ISO-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
    <title>5.7.2. Streams de cadena de salida</title>
    <link rel="stylesheet" type="text/css" href="common.css" />
    <link rel="stylesheet" type="text/css" href="chunk.css" />
    <link rel="stylesheet" type="text/css" href="highlight.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.76.1" />
    <link rel="home" href="index.html" title="Pensar en C++ (Volumen 2)" />
    <link rel="up" href="ch05s07.html" title="5.7. Iostreams de string" />
    <link rel="prev" href="ch05s07.html" title="5.7. Iostreams de string" />
    <link rel="next" href="ch05s08.html" title="5.8. Formateo de stream de salida" />
  </head>
  <body>
    <div class="navfooter">
      <hr />
      <table width="100%" summary="Navigation footer">
        <tr>
          <td class="navititle" width="1%">
            <a accesskey="p" href="ch05s07.html">
              <img src="./images/prev.png" alt="Anterior" />
            </a>
          </td>
          <td class="navititle" width="40%" align="left">
            <a accesskey="p" href="ch05s07.html">5.7. Iostreams de <code class="classname">string</code></a>
          </td>
          <td width="10%" align="center">
            <a accesskey="u" href="ch05s07.html">
              <img src="./images/up.png" alt="Subir" />
            </a>
          </td>
          <td class="navititle" width="40%" align="right">
            <a accesskey="n" href="ch05s08.html">5.8. Formateo de stream de salida</a>
          </td>
          <td class="navititle" width="1%" align="right">
            <a accesskey="n" href="ch05s08.html">
              <img src="./images/next.png" alt="Siguiente" />
            </a>
          </td>
        </tr>
      </table>
    </div>
    <div class="sect2" title="5.7.2. Streams de cadena de salida">
      <div class="titlepage">
        <div>
          <div>
            <h3 class="title"><a id="idp4208616"></a>5.7.2. Streams de cadena de salida</h3>
          </div>
        </div>
      </div>
      <p>
	Para crear un stream de cadena de salida, simplemente cree un
	objeto ostringstream, que maneja un buffer de carácteres
	dinamicamente dimensionado para guardar cualquier cosas que
	usted inserte. Para tomar el resultado formateado como un
	objeto de string, llame a la función miembro setr(). Aqui
	tiene un ejemplo:
      </p>
      <div class="example">
        <a id="idp4209792"></a>
        <div class="example-contents">
          <pre class="programlisting">
<span class="hl slc">//: C04:Ostring.cpp {RunByHand}</span>
<span class="hl slc">// Illustrates ostringstream.</span>
<span class="hl ppc">#include &lt;iostream&gt;</span>
<span class="hl ppc">#include &lt;sstream&gt;</span>
<span class="hl ppc">#include &lt;string&gt;</span>
<span class="hl kwa">using namespace</span> std<span class="hl opt">;</span>

<span class="hl kwb">int</span> <span class="hl kwd">main</span><span class="hl opt">() {</span>
  cout <span class="hl opt">&lt;&lt;</span> <span class="hl str">&quot;type an int, a float and a string: &quot;</span><span class="hl opt">;</span>
  <span class="hl kwb">int</span> i<span class="hl opt">;</span>
  <span class="hl kwb">float</span> f<span class="hl opt">;</span>
  cin <span class="hl opt">&gt;&gt;</span> i <span class="hl opt">&gt;&gt;</span> f<span class="hl opt">;</span>
  cin <span class="hl opt">&gt;&gt;</span> ws<span class="hl opt">;</span> <span class="hl slc">// Throw away white space</span>
  string stuff<span class="hl opt">;</span>
  <span class="hl kwd">getline</span><span class="hl opt">(</span>cin<span class="hl opt">,</span> stuff<span class="hl opt">);</span> <span class="hl slc">// Get rest of the line</span>
  ostringstream os<span class="hl opt">;</span>
  os <span class="hl opt">&lt;&lt;</span> <span class="hl str">&quot;integer = &quot;</span> <span class="hl opt">&lt;&lt;</span> i <span class="hl opt">&lt;&lt;</span> endl<span class="hl opt">;</span>
  os <span class="hl opt">&lt;&lt;</span> <span class="hl str">&quot;float = &quot;</span> <span class="hl opt">&lt;&lt;</span> f <span class="hl opt">&lt;&lt;</span> endl<span class="hl opt">;</span>
  os <span class="hl opt">&lt;&lt;</span> <span class="hl str">&quot;string = &quot;</span> <span class="hl opt">&lt;&lt;</span> stuff <span class="hl opt">&lt;&lt;</span> endl<span class="hl opt">;</span>
  string result <span class="hl opt">=</span> os<span class="hl opt">.</span><span class="hl kwd">str</span><span class="hl opt">();</span>
  cout <span class="hl opt">&lt;&lt;</span> result <span class="hl opt">&lt;&lt;</span> endl<span class="hl opt">;</span>
<span class="hl opt">}</span> <span class="hl slc">///:~</span>
</pre>
        </div>
        <p class="title">
          <strong>Listado 5.12. C04/Ostring.cpp</strong>
        </p>
      </div>
      <br class="example-break" />
      <p>
	Esto es similar al ejemplo Istring.cpp anterior que pedía un
	<code class="type">int</code> y un <code class="type">float</code>. A continueación una
	simple ejecución (la entrada por teclado está escrita en
	negrita).
      </p>
      <pre class="screen">
type an int, a float and a string: FIXME:10 20.5 the end
integer = 10
float = 20.5
string = the end
</pre>
      <p>
	Puede ver que, como otros <code class="classname">stream</code> de
	salida, puede usar las herramientas ordinarias de formateo,
	como el operador &lt;&lt; y <code class="function">endl</code>, para
	enviar bytes hacia el <code class="classname">ostringstream</code>. La
	función <code class="function">str()</code> devuelve un nuevo objeto
	<code class="classname">string</code> cada vez que usted la llama con
	lo que el <code class="classname">stringbuf</code> contenido permanece
	inalterado.
      </p>
      <p>
	En el capítulo previo, presentamos un programa,
	HTMLStripper.cpp, que borraba todas las etiqietas HTML y los
	códigos especiales de un fichero de texto. Como prometíamos,
	aqui está una versión más elegante usando
	<code class="classname">streams</code> de cadena.
      </p>
      <div class="example">
        <a id="idp4215648"></a>
        <div class="example-contents">
          <pre class="programlisting">
<span class="hl slc">//: C04:HTMLStripper2.cpp {RunByHand}</span>
<span class="hl slc">//{L} ../C03/ReplaceAll</span>
<span class="hl slc">// Filter to remove html tags and markers.</span>
<span class="hl ppc">#include &lt;cstddef&gt;</span>
<span class="hl ppc">#include &lt;cstdlib&gt;</span>
<span class="hl ppc">#include &lt;fstream&gt;</span>
<span class="hl ppc">#include &lt;iostream&gt;</span>
<span class="hl ppc">#include &lt;sstream&gt;</span>
<span class="hl ppc">#include &lt;stdexcept&gt;</span>
<span class="hl ppc">#include &lt;string&gt;</span>
<span class="hl ppc">#include</span> <span class="hl pps">&quot;../C03/ReplaceAll.h&quot;</span><span class="hl ppc"></span>
<span class="hl ppc">#include</span> <span class="hl pps">&quot;../require.h&quot;</span><span class="hl ppc"></span>
<span class="hl kwa">using namespace</span> std<span class="hl opt">;</span>

string<span class="hl opt">&amp;</span> <span class="hl kwd">stripHTMLTags</span><span class="hl opt">(</span>string<span class="hl opt">&amp;</span> s<span class="hl opt">)</span> <span class="hl kwa">throw</span><span class="hl opt">(</span>runtime_error<span class="hl opt">) {</span>
  <span class="hl kwb">size_t</span> leftPos<span class="hl opt">;</span>
  <span class="hl kwa">while</span><span class="hl opt">((</span>leftPos <span class="hl opt">=</span> s<span class="hl opt">.</span><span class="hl kwd">find</span><span class="hl opt">(</span><span class="hl str">'&lt;'</span><span class="hl opt">)) !=</span> string<span class="hl opt">::</span>npos<span class="hl opt">) {</span>
    <span class="hl kwb">size_t</span> rightPos <span class="hl opt">=</span> s<span class="hl opt">.</span><span class="hl kwd">find</span><span class="hl opt">(</span><span class="hl str">'&gt;'</span><span class="hl opt">,</span> leftPos<span class="hl opt">+</span><span class="hl num">1</span><span class="hl opt">);</span>
    <span class="hl kwa">if</span><span class="hl opt">(</span>rightPos <span class="hl opt">==</span> string<span class="hl opt">::</span>npos<span class="hl opt">) {</span>
      ostringstream msg<span class="hl opt">;</span>
      msg <span class="hl opt">&lt;&lt;</span> <span class="hl str">&quot;Incomplete HTML tag starting in position &quot;</span>
          <span class="hl opt">&lt;&lt;</span> leftPos<span class="hl opt">;</span>
      <span class="hl kwa">throw</span> <span class="hl kwd">runtime_error</span><span class="hl opt">(</span>msg<span class="hl opt">.</span><span class="hl kwd">str</span><span class="hl opt">());</span>
    <span class="hl opt">}</span>
    s<span class="hl opt">.</span><span class="hl kwd">erase</span><span class="hl opt">(</span>leftPos<span class="hl opt">,</span> rightPos <span class="hl opt">-</span> leftPos <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl opt">);</span>
  <span class="hl opt">}</span>
  <span class="hl slc">// Remove all special HTML characters</span>
  <span class="hl kwd">replaceAll</span><span class="hl opt">(</span>s<span class="hl opt">,</span> <span class="hl str">&quot;&amp;lt;&quot;</span><span class="hl opt">,</span> <span class="hl str">&quot;&lt;&quot;</span><span class="hl opt">);</span>
  <span class="hl kwd">replaceAll</span><span class="hl opt">(</span>s<span class="hl opt">,</span> <span class="hl str">&quot;&amp;gt;&quot;</span><span class="hl opt">,</span> <span class="hl str">&quot;&gt;&quot;</span><span class="hl opt">);</span>
  <span class="hl kwd">replaceAll</span><span class="hl opt">(</span>s<span class="hl opt">,</span> <span class="hl str">&quot;&amp;amp;&quot;</span><span class="hl opt">,</span> <span class="hl str">&quot;&amp;&quot;</span><span class="hl opt">);</span>
  <span class="hl kwd">replaceAll</span><span class="hl opt">(</span>s<span class="hl opt">,</span> <span class="hl str">&quot;&amp;nbsp;&quot;</span><span class="hl opt">,</span> <span class="hl str">&quot; &quot;</span><span class="hl opt">);</span>
  <span class="hl slc">// Etc...</span>
  <span class="hl kwa">return</span> s<span class="hl opt">;</span>
<span class="hl opt">}</span>

<span class="hl kwb">int</span> <span class="hl kwd">main</span><span class="hl opt">(</span><span class="hl kwb">int</span> argc<span class="hl opt">,</span> <span class="hl kwb">char</span><span class="hl opt">*</span> argv<span class="hl opt">[]) {</span>
  <span class="hl kwd">requireArgs</span><span class="hl opt">(</span>argc<span class="hl opt">,</span> <span class="hl num">1</span><span class="hl opt">,</span>
    <span class="hl str">&quot;usage: HTMLStripper2 InputFile&quot;</span><span class="hl opt">);</span>
  ifstream <span class="hl kwd">in</span><span class="hl opt">(</span>argv<span class="hl opt">[</span><span class="hl num">1</span><span class="hl opt">]);</span>
  <span class="hl kwd">assure</span><span class="hl opt">(</span>in<span class="hl opt">,</span> argv<span class="hl opt">[</span><span class="hl num">1</span><span class="hl opt">]);</span>
  <span class="hl slc">// Read entire file into string; then strip</span>
  ostringstream ss<span class="hl opt">;</span>
  ss <span class="hl opt">&lt;&lt;</span> in<span class="hl opt">.</span><span class="hl kwd">rdbuf</span><span class="hl opt">();</span>
  <span class="hl kwa">try</span> <span class="hl opt">{</span>
    string s <span class="hl opt">=</span> ss<span class="hl opt">.</span><span class="hl kwd">str</span><span class="hl opt">();</span>
    cout <span class="hl opt">&lt;&lt;</span> <span class="hl kwd">stripHTMLTags</span><span class="hl opt">(</span>s<span class="hl opt">) &lt;&lt;</span> endl<span class="hl opt">;</span>
    <span class="hl kwa">return</span> EXIT_SUCCESS<span class="hl opt">;</span>
  <span class="hl opt">}</span> <span class="hl kwa">catch</span><span class="hl opt">(</span>runtime_error<span class="hl opt">&amp;</span> x<span class="hl opt">) {</span>
    cout <span class="hl opt">&lt;&lt;</span> x<span class="hl opt">.</span><span class="hl kwd">what</span><span class="hl opt">() &lt;&lt;</span> endl<span class="hl opt">;</span>
    <span class="hl kwa">return</span> EXIT_FAILURE<span class="hl opt">;</span>
  <span class="hl opt">}</span>
<span class="hl opt">}</span> <span class="hl slc">///:~</span>
</pre>
        </div>
        <p class="title">
          <strong>Listado 5.13. C04/HTMLStripper2.cpp</strong>
        </p>
      </div>
      <br class="example-break" />
      <p>
	En este programa leemos el fichero entero dentro de un <code class="classname">string</code> insertando una llamada <code class="function">rdbuf()</code>
	del <code class="classname">stream</code> de fichero al <code class="classname">ostringstream</code>. Ahora es fácil buscar parejas de delimitadores HTML
	y borrarlas sin tener que preocuparnos de límites de líneas como teniamos con la versión previa en el Capítulo 3.
      </p>
      <p>
	El siguiente ejemplo muestra como usar un stream de cadena
	bidireccional (esto es, lectura/escritura):
      </p>
      <div class="example">
        <a id="idp4219984"></a>
        <div class="example-contents">
          <pre class="programlisting">
<span class="hl slc">//: C04:StringSeeking.cpp {-bor}{-dmc}</span>
<span class="hl slc">// Reads and writes a string stream.</span>
<span class="hl ppc">#include &lt;cassert&gt;</span>
<span class="hl ppc">#include &lt;sstream&gt;</span>
<span class="hl ppc">#include &lt;string&gt;</span>
<span class="hl kwa">using namespace</span> std<span class="hl opt">;</span>

<span class="hl kwb">int</span> <span class="hl kwd">main</span><span class="hl opt">() {</span>
  string text <span class="hl opt">=</span> <span class="hl str">&quot;We will hook no fish&quot;</span><span class="hl opt">;</span>
  stringstream <span class="hl kwd">ss</span><span class="hl opt">(</span>text<span class="hl opt">);</span>
  ss<span class="hl opt">.</span><span class="hl kwd">seekp</span><span class="hl opt">(</span><span class="hl num">0</span><span class="hl opt">,</span> ios<span class="hl opt">::</span>end<span class="hl opt">);</span>
  ss <span class="hl opt">&lt;&lt;</span> <span class="hl str">&quot; before its time.&quot;</span><span class="hl opt">;</span>
  <span class="hl kwa">assert</span><span class="hl opt">(</span>ss<span class="hl opt">.</span><span class="hl kwd">str</span><span class="hl opt">() ==</span>
    <span class="hl str">&quot;We will hook no fish before its time.&quot;</span><span class="hl opt">);</span>
  <span class="hl slc">// Change &quot;hook&quot; to &quot;ship&quot;</span>
  ss<span class="hl opt">.</span><span class="hl kwd">seekg</span><span class="hl opt">(</span><span class="hl num">8</span><span class="hl opt">,</span> ios<span class="hl opt">::</span>beg<span class="hl opt">);</span>
  string word<span class="hl opt">;</span>
  ss <span class="hl opt">&gt;&gt;</span> word<span class="hl opt">;</span>
  <span class="hl kwa">assert</span><span class="hl opt">(</span>word <span class="hl opt">==</span> <span class="hl str">&quot;hook&quot;</span><span class="hl opt">);</span>
  ss<span class="hl opt">.</span><span class="hl kwd">seekp</span><span class="hl opt">(</span><span class="hl num">8</span><span class="hl opt">,</span> ios<span class="hl opt">::</span>beg<span class="hl opt">);</span>
  ss <span class="hl opt">&lt;&lt;</span> <span class="hl str">&quot;ship&quot;</span><span class="hl opt">;</span>
  <span class="hl slc">// Change &quot;fish&quot; to &quot;code&quot;</span>
  ss<span class="hl opt">.</span><span class="hl kwd">seekg</span><span class="hl opt">(</span><span class="hl num">16</span><span class="hl opt">,</span> ios<span class="hl opt">::</span>beg<span class="hl opt">);</span>
  ss <span class="hl opt">&gt;&gt;</span> word<span class="hl opt">;</span>
  <span class="hl kwa">assert</span><span class="hl opt">(</span>word <span class="hl opt">==</span> <span class="hl str">&quot;fish&quot;</span><span class="hl opt">);</span>
  ss<span class="hl opt">.</span><span class="hl kwd">seekp</span><span class="hl opt">(</span><span class="hl num">16</span><span class="hl opt">,</span> ios<span class="hl opt">::</span>beg<span class="hl opt">);</span>
  ss <span class="hl opt">&lt;&lt;</span> <span class="hl str">&quot;code&quot;</span><span class="hl opt">;</span>
  <span class="hl kwa">assert</span><span class="hl opt">(</span>ss<span class="hl opt">.</span><span class="hl kwd">str</span><span class="hl opt">() ==</span>
    <span class="hl str">&quot;We will ship no code before its time.&quot;</span><span class="hl opt">);</span>
  ss<span class="hl opt">.</span><span class="hl kwd">str</span><span class="hl opt">(</span><span class="hl str">&quot;A horse of a different color.&quot;</span><span class="hl opt">);</span>
  <span class="hl kwa">assert</span><span class="hl opt">(</span>ss<span class="hl opt">.</span><span class="hl kwd">str</span><span class="hl opt">() ==</span> <span class="hl str">&quot;A horse of a different color.&quot;</span><span class="hl opt">);</span>
<span class="hl opt">}</span> <span class="hl slc">///:~</span>
</pre>
        </div>
        <p class="title">
          <strong>Listado 5.14. C04/StringSeeking.cpp</strong>
        </p>
      </div>
      <br class="example-break" />
      <p>
	Como siempre para mover el puntero de inserción, usted llama a
	<code class="function">seekp()</code>, y para reposicionar el fichero
	de lectura, usted llama a
	<code class="function">seekg()</code>. Incluso aunque no lo hemos
	mostrado con este ejemplo, los <code class="classname">stream</code>
	de cadeana son un poco más permisivos que los
	<code class="classname">stream</code> de fichero ya que podemos
	cambiar de lectura a escritura y viceversa en cualquier
	momento. No necesita reposicionar el puntero de lectura o de
	escritura o vaciar el <code class="classname">stream</code>. Este
	progrma también ilustra la sobrecarga de
	<code class="function">str()</code> que reemplaza el
	<code class="classname">stringbuf</code> contenido en el
	<code class="classname">stream</code> con una nueva cadena.
      </p>
    </div>
    <div class="navfooter">
      <hr />
      <table width="100%" summary="Navigation footer">
        <tr>
          <td class="navititle" width="1%">
            <a accesskey="p" href="ch05s07.html">
              <img src="./images/prev.png" alt="Anterior" />
            </a>
          </td>
          <td class="navititle" width="40%" align="left">
            <a accesskey="p" href="ch05s07.html">5.7. Iostreams de <code class="classname">string</code></a>
          </td>
          <td width="10%" align="center">
            <a accesskey="u" href="ch05s07.html">
              <img src="./images/up.png" alt="Subir" />
            </a>
          </td>
          <td class="navititle" width="40%" align="right">
            <a accesskey="n" href="ch05s08.html">5.8. Formateo de stream de salida</a>
          </td>
          <td class="navititle" width="1%" align="right">
            <a accesskey="n" href="ch05s08.html">
              <img src="./images/next.png" alt="Siguiente" />
            </a>
          </td>
        </tr>
        <tr>
          <td valign="top"> </td>
          <td> </td>
          <td width="10%" align="center">
            <a accesskey="h" href="index.html">
              <img src="./images/home.png" alt="Inicio" />
            </a>
          </td>
          <td> </td>
          <td valign="top"> </td>
        </tr>
      </table>
    </div>
  </body>
</html>
