<?xml version="1.0" encoding="ISO-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
    <title>12.6.2. Conversión por operador</title>
    <link rel="stylesheet" type="text/css" href="common.css" />
    <link rel="stylesheet" type="text/css" href="chunk.css" />
    <link rel="stylesheet" type="text/css" href="highlight.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.76.1" />
    <link rel="home" href="index.html" title="Pensar en C++ (Volumen 1)" />
    <link rel="up" href="ch12s06.html" title="12.6. Conversión automática de tipos" />
    <link rel="prev" href="ch12s06.html" title="12.6. Conversión automática de tipos" />
    <link rel="next" href="ch12s06s03.html" title="12.6.3. Ejemplo de conversión de tipos" />
  </head>
  <body>
    <div class="navfooter">
      <hr />
      <table width="100%" summary="Navigation footer">
        <tr>
          <td class="navititle" width="1%">
            <a accesskey="p" href="ch12s06.html">
              <img src="./images/prev.png" alt="Anterior" />
            </a>
          </td>
          <td class="navititle" width="40%" align="left">
            <a accesskey="p" href="ch12s06.html">12.6. Conversión automática de tipos</a>
          </td>
          <td width="10%" align="center">
            <a accesskey="u" href="ch12s06.html">
              <img src="./images/up.png" alt="Subir" />
            </a>
          </td>
          <td class="navititle" width="40%" align="right">
            <a accesskey="n" href="ch12s06s03.html">12.6.3. Ejemplo de conversión de tipos</a>
          </td>
          <td class="navititle" width="1%" align="right">
            <a accesskey="n" href="ch12s06s03.html">
              <img src="./images/next.png" alt="Siguiente" />
            </a>
          </td>
        </tr>
      </table>
    </div>
    <div class="sect2" title="12.6.2. Conversión por operador">
      <div class="titlepage">
        <div>
          <div>
            <h3 class="title"><a id="idp7388816"></a>12.6.2. Conversión por operador</h3>
          </div>
        </div>
      </div>
      <p>
		La segunda forma de producir conversiones automáticas de tipo es a través de la
		sobrecarga de operadores. Puede crear un método que tome el tipo actual
		y lo convierta al tipo deseado usando la palabra reservada
		<code class="literal">operator</code> seguida del tipo al que quiere convertir. Esta forma de
		sobrecarga de operadores es única porque parece que no se especifica un tipo de
		retorno -- el tipo de retorno es el nombre del operador que está sobrecargando. He
		aquí un ejemplo:
      </p>
      <div class="example">
        <a id="idp7390832"></a>
        <div class="example-contents">
          <pre class="programlisting">
<span class="hl slc">//: C12:OperatorOverloadingConversion.cpp</span>
<span class="hl kwc">class</span> Three <span class="hl opt">{</span>
  <span class="hl kwb">int</span> i<span class="hl opt">;</span>
<span class="hl kwc">public</span><span class="hl opt">:</span>
  <span class="hl kwd">Three</span><span class="hl opt">(</span><span class="hl kwb">int</span> ii <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">,</span> <span class="hl kwb">int</span> <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">) :</span> <span class="hl kwd">i</span><span class="hl opt">(</span>ii<span class="hl opt">) {}</span>
<span class="hl opt">};</span>

<span class="hl kwc">class</span> Four <span class="hl opt">{</span>
  <span class="hl kwb">int</span> x<span class="hl opt">;</span>
<span class="hl kwc">public</span><span class="hl opt">:</span>
  <span class="hl kwd">Four</span><span class="hl opt">(</span><span class="hl kwb">int</span> xx<span class="hl opt">) :</span> <span class="hl kwd">x</span><span class="hl opt">(</span>xx<span class="hl opt">) {}</span>
  <span class="hl kwc">operator</span> <span class="hl kwd">Three</span><span class="hl opt">()</span> <span class="hl kwb">const</span> <span class="hl opt">{</span> <span class="hl kwa">return</span> <span class="hl kwd">Three</span><span class="hl opt">(</span>x<span class="hl opt">); }</span>
<span class="hl opt">};</span>

<span class="hl kwb">void</span> <span class="hl kwd">g</span><span class="hl opt">(</span>Three<span class="hl opt">) {}</span>

<span class="hl kwb">int</span> <span class="hl kwd">main</span><span class="hl opt">() {</span>
  Four <span class="hl kwd">four</span><span class="hl opt">(</span><span class="hl num">1</span><span class="hl opt">);</span>
  <span class="hl kwd">g</span><span class="hl opt">(</span>four<span class="hl opt">);</span>
  <span class="hl kwd">g</span><span class="hl opt">(</span><span class="hl num">1</span><span class="hl opt">);</span>  <span class="hl slc">// Calls Three(1,0)</span>
<span class="hl opt">}</span> <span class="hl slc">///:~</span>
</pre>
        </div>
        <p class="title">
          <strong>Listado 12.20. C12/OperatorOverloadingConversion.cpp</strong>
        </p>
      </div>
      <br class="example-break" />
      <p>
		Con la técnica del constructor, la clase destino realiza la conversión, pero con
		los operadores, la realiza la clase origen. El valor de la técnica del constructor
		es que puede añadir una nueva ruta de conversión a un sistema existente al crear
		una nueva clase. Sin embargo, creando un constructor con un único argumento
		siempre define una conversión automática de tipos (incluso si requiere más de un
		argumento si el resto de los argumentos tiene un valor por defecto), que puede no
		ser lo que desea (en cuyo caso puede desactivarlo usando
		<code class="keyword">explicit</code>). Además, no hay ninguna forma de usar una conversión por
		constructor desde un tipo definido por el usuario a un tipo incorporado; eso sólo
		es posible con la sobrecarga de operadores.
      </p>
      <div class="sect3" title="Reflexividad">
        <div class="titlepage">
          <div>
            <div>
              <h4 class="title"><a id="idp7393784"></a>Reflexividad</h4>
            </div>
          </div>
        </div>
        <p>
		  Una de las razones más convenientes para usar operadores sobrecargados globales
		  en lugar de operadores miembros es que en la versión global, la conversión
		  automática de tipos puede aplicarse a cualquiera de los operandos, mientras que
		  con objetos miembro, el operando de la parte izquierda debe ser del tipo
		  apropiado. Si quiere que ambos operandos sean convertidos, la versión global
		  puede ahorrar un montón de código. He aquí un pequeño ejemplo:
		</p>
        <div class="example">
          <a id="idp7394976"></a>
          <div class="example-contents">
            <pre class="programlisting">
<span class="hl slc">//: C12:ReflexivityInOverloading.cpp</span>
<span class="hl kwc">class</span> Number <span class="hl opt">{</span>
  <span class="hl kwb">int</span> i<span class="hl opt">;</span>
<span class="hl kwc">public</span><span class="hl opt">:</span>
  <span class="hl kwd">Number</span><span class="hl opt">(</span><span class="hl kwb">int</span> ii <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">) :</span> <span class="hl kwd">i</span><span class="hl opt">(</span>ii<span class="hl opt">) {}</span>
  <span class="hl kwb">const</span> Number
  <span class="hl kwc">operator</span><span class="hl opt">+(</span><span class="hl kwb">const</span> Number<span class="hl opt">&amp;</span> n<span class="hl opt">)</span> <span class="hl kwb">const</span> <span class="hl opt">{</span>
    <span class="hl kwa">return</span> <span class="hl kwd">Number</span><span class="hl opt">(</span>i <span class="hl opt">+</span> n<span class="hl opt">.</span>i<span class="hl opt">);</span>
  <span class="hl opt">}</span>
  <span class="hl kwc">friend</span> <span class="hl kwb">const</span> Number
    <span class="hl kwc">operator</span><span class="hl opt">-(</span><span class="hl kwb">const</span> Number<span class="hl opt">&amp;,</span> <span class="hl kwb">const</span> Number<span class="hl opt">&amp;);</span>
<span class="hl opt">};</span>

<span class="hl kwb">const</span> Number
  <span class="hl kwc">operator</span><span class="hl opt">-(</span><span class="hl kwb">const</span> Number<span class="hl opt">&amp;</span> n1<span class="hl opt">,</span>
            <span class="hl kwb">const</span> Number<span class="hl opt">&amp;</span> n2<span class="hl opt">) {</span>
    <span class="hl kwa">return</span> <span class="hl kwd">Number</span><span class="hl opt">(</span>n1<span class="hl opt">.</span>i <span class="hl opt">-</span> n2<span class="hl opt">.</span>i<span class="hl opt">);</span>
<span class="hl opt">}</span>

<span class="hl kwb">int</span> <span class="hl kwd">main</span><span class="hl opt">() {</span>
  Number <span class="hl kwd">a</span><span class="hl opt">(</span><span class="hl num">47</span><span class="hl opt">),</span> <span class="hl kwd">b</span><span class="hl opt">(</span><span class="hl num">11</span><span class="hl opt">);</span>
  a <span class="hl opt">+</span> b<span class="hl opt">;</span> <span class="hl slc">// OK</span>
  a <span class="hl opt">+</span> <span class="hl num">1</span><span class="hl opt">;</span> <span class="hl slc">// 2nd arg converted to Number</span>
<span class="hl slc">//! 1 + a; // Wrong! 1st arg not of type Number</span>
  a <span class="hl opt">-</span> b<span class="hl opt">;</span> <span class="hl slc">// OK</span>
  a <span class="hl opt">-</span> <span class="hl num">1</span><span class="hl opt">;</span> <span class="hl slc">// 2nd arg converted to Number</span>
  <span class="hl num">1</span> <span class="hl opt">-</span> a<span class="hl opt">;</span> <span class="hl slc">// 1st arg converted to Number</span>
<span class="hl opt">}</span> <span class="hl slc">///:~</span>
</pre>
          </div>
          <p class="title">
            <strong>Listado 12.21. C12/ReflexivityInOverloading.cpp</strong>
          </p>
        </div>
        <br class="example-break" />
        <p>
		  La clase <code class="classname">Number</code> tiene tanto un miembro
		  <code class="literal">operator+</code> como un <code class="literal">friend operator-</code>. Dado que hay un
		  constructor que acepta un argumento <code class="type">int</code> simple, se puede convertir
		  un <code class="type">int</code> automáticamente a <code class="classname">Number</code>, pero sólo
		  bajo las condiciones adecuadas. En <code class="function">main()</code>, puede ver que
		  sumar un <code class="classname">Number</code> a otro <code class="classname">Number</code>
		  funciona bien dado que tiene una correspondencia exacta con el operador
		  sobrecargado. Además, cuando el compilador ve un <code class="classname">Number</code>
		  seguido de un <code class="literal">+</code> y de un <code class="type">int</code>, puede hacer la
		  correspondencia al método <code class="function">Number::operator+</code> y convertir el
		  argumento <code class="type">int</code> an <code class="classname">Number</code> usando el
		  constructor. Pero cuando ve un <code class="type">int</code>, un <code class="literal">+</code> y un
		  <code class="classname">Number</code>, no sabe qué hacer porque todo lo que tiene es
		  <code class="literal">Number::operator+</code> que requiere que el operando de la izquierda sea
		  ya un objeto <code class="classname">Number</code>. Así que, el compilador genera un
		  error.
		</p>
        <p>
		  Con <code class="literal">friend operator-</code> las cosas son diferentes. El compilador
		  necesita rellenar ambos argumentos como quiera; no está restringido a tener un
		  <code class="classname">Number</code> como argumento de la parte izquierda. así que si
		  ve:
	</p>
        <pre class="programlisting">
<span class="hl num">1</span> <span class="hl opt">-</span> a
</pre>
        <p>
		  puede convertir el primer argumento a <code class="classname">Number</code> usando el
		  constructor.
		</p>
        <p>
		  A veces querrá ser capaz de restringir el uso de sus operadores haciéndolos
		  métodos. Por ejemplo, cuando multiplique una matriz por un vector, el vector
		  debe ir a la derecha. Pero si quiere que sus operadores sean capaces de
		  convertir cualquier argumento, haga el operador una función <code class="keyword">friend</code>.
		</p>
        <p>
		  Afortunadamente, el compilador cogerá la expresión <code class="code">1-1</code> y convertirá
		  ambos argumentos a objetos <code class="classname">Number</code> y después llamará a
		  <code class="literal">operator-</code>. Eso significaría que el código C existente podría
		  empezar a funcionar de forma diferente. El compilador intenta primero la
		  correspondencia «más simple», es decir, en este caso el operador
		  incorporado para la expresión <code class="code">1-1</code>.
		</p>
      </div>
    </div>
    <div class="navfooter">
      <hr />
      <table width="100%" summary="Navigation footer">
        <tr>
          <td class="navititle" width="1%">
            <a accesskey="p" href="ch12s06.html">
              <img src="./images/prev.png" alt="Anterior" />
            </a>
          </td>
          <td class="navititle" width="40%" align="left">
            <a accesskey="p" href="ch12s06.html">12.6. Conversión automática de tipos</a>
          </td>
          <td width="10%" align="center">
            <a accesskey="u" href="ch12s06.html">
              <img src="./images/up.png" alt="Subir" />
            </a>
          </td>
          <td class="navititle" width="40%" align="right">
            <a accesskey="n" href="ch12s06s03.html">12.6.3. Ejemplo de conversión de tipos</a>
          </td>
          <td class="navititle" width="1%" align="right">
            <a accesskey="n" href="ch12s06s03.html">
              <img src="./images/next.png" alt="Siguiente" />
            </a>
          </td>
        </tr>
        <tr>
          <td valign="top"> </td>
          <td> </td>
          <td width="10%" align="center">
            <a accesskey="h" href="index.html">
              <img src="./images/home.png" alt="Inicio" />
            </a>
          </td>
          <td> </td>
          <td valign="top"> </td>
        </tr>
      </table>
    </div>
  </body>
</html>
