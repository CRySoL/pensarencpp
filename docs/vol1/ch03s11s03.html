<?xml version="1.0" encoding="ISO-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
    <title>3.11.3. Un ejemplo de Makefile</title>
    <link rel="stylesheet" type="text/css" href="common.css" />
    <link rel="stylesheet" type="text/css" href="chunk.css" />
    <link rel="stylesheet" type="text/css" href="highlight.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.76.1" />
    <link rel="home" href="index.html" title="Pensar en C++ (Volumen 1)" />
    <link rel="up" href="ch03s11.html" title="3.11. Make: cómo hacer compilación separada" />
    <link rel="prev" href="ch03s11s02.html" title="3.11.2. Los Makefiles de este libro" />
    <link rel="next" href="ch03s12.html" title="3.12. Resumen" />
  </head>
  <body>
    <div class="navfooter">
      <hr />
      <table width="100%" summary="Navigation footer">
        <tr>
          <td class="navititle" width="1%">
            <a accesskey="p" href="ch03s11s02.html">
              <img src="./images/prev.png" alt="Anterior" />
            </a>
          </td>
          <td class="navititle" width="40%" align="left">
            <a accesskey="p" href="ch03s11s02.html">3.11.2. Los Makefiles de este libro</a>
          </td>
          <td width="10%" align="center">
            <a accesskey="u" href="ch03s11.html">
              <img src="./images/up.png" alt="Subir" />
            </a>
          </td>
          <td class="navititle" width="40%" align="right">
            <a accesskey="n" href="ch03s12.html">3.12. Resumen</a>
          </td>
          <td class="navititle" width="1%" align="right">
            <a accesskey="n" href="ch03s12.html">
              <img src="./images/next.png" alt="Siguiente" />
            </a>
          </td>
        </tr>
      </table>
    </div>
    <div class="sect2" title="3.11.3. Un ejemplo de Makefile">
      <div class="titlepage">
        <div>
          <div>
            <h3 class="title"><a id="idp5092144"></a>3.11.3. Un ejemplo de Makefile</h3>
          </div>
        </div>
      </div>
      <p>
	Tal como se mencionaba, la herramienta de extracción de código
	<code class="filename">ExtractCode.cpp</code> genera automáticamente
	<code class="filename">makefiles</code> para cada capítulo. Por eso, los
	<code class="filename">makefiles</code> de cada capítulo no aparecen en
	el libro (todos los <code class="filename">makefiles</code> están
	empaquetados con el código fuente, que se puede descargar de
	<a class="ulink" href="http://www.bruceeckel.com" target="_top">www.BruceEckel.com</a>).
	Sin embargo, es útil ver un ejemplo de un
	<code class="filename">makefile</code>. Lo siguiente es una versión
	recortada de uno de esos <code class="filename">makefiles</code>
	generados automáticamente para este capítulo. Encontrará más de
	un <code class="filename">makefile</code> en cada subdirectorio (tienen
	nombres diferentes; puede invocar uno concreto con <span class="command"><strong>make
	-f</strong></span>. Éste es para GNU C++:
      </p>
      <pre class="programlisting">
CPP <span class="hl opt">=</span> g<span class="hl opt">++</span>
OFLAG <span class="hl opt">= -</span>o
<span class="hl opt">.</span>SUFFIXES <span class="hl opt">: .</span>o <span class="hl opt">.</span>cpp <span class="hl opt">.</span>c
<span class="hl opt">.</span>cpp<span class="hl opt">.</span>o <span class="hl opt">:</span>
  $<span class="hl opt">(</span>CPP<span class="hl opt">)</span> $<span class="hl opt">(</span>CPPFLAGS<span class="hl opt">) -</span>c $<span class="hl opt">&lt;</span>
<span class="hl opt">.</span>c<span class="hl opt">.</span>o <span class="hl opt">:</span>
  $<span class="hl opt">(</span>CPP<span class="hl opt">)</span> $<span class="hl opt">(</span>CPPFLAGS<span class="hl opt">) -</span>c $<span class="hl opt">&lt;</span>

all<span class="hl opt">:</span> \
  Return \
  Declare \
  Ifthen \
  Guess \
  Guess2
<span class="hl ppc"># Rest of the files for this chapter not shown</span>

Return<span class="hl opt">:</span> Return<span class="hl opt">.</span>o
  $<span class="hl opt">(</span>CPP<span class="hl opt">)</span> $<span class="hl opt">(</span>OFLAG<span class="hl opt">)</span>Return Return<span class="hl opt">.</span>o

Declare<span class="hl opt">:</span> Declare<span class="hl opt">.</span>o
  $<span class="hl opt">(</span>CPP<span class="hl opt">)</span> $<span class="hl opt">(</span>OFLAG<span class="hl opt">)</span>Declare Declare<span class="hl opt">.</span>o

Ifthen<span class="hl opt">:</span> Ifthen<span class="hl opt">.</span>o
  $<span class="hl opt">(</span>CPP<span class="hl opt">)</span> $<span class="hl opt">(</span>OFLAG<span class="hl opt">)</span>Ifthen Ifthen<span class="hl opt">.</span>o

Guess<span class="hl opt">:</span> Guess<span class="hl opt">.</span>o
  $<span class="hl opt">(</span>CPP<span class="hl opt">)</span> $<span class="hl opt">(</span>OFLAG<span class="hl opt">)</span>Guess Guess<span class="hl opt">.</span>o

Guess2<span class="hl opt">:</span> Guess2<span class="hl opt">.</span>o
  $<span class="hl opt">(</span>CPP<span class="hl opt">)</span> $<span class="hl opt">(</span>OFLAG<span class="hl opt">)</span>Guess2 Guess2<span class="hl opt">.</span>o

Return<span class="hl opt">.</span>o<span class="hl opt">:</span> Return<span class="hl opt">.</span>cpp
Declare<span class="hl opt">.</span>o<span class="hl opt">:</span> Declare<span class="hl opt">.</span>cpp
Ifthen<span class="hl opt">.</span>o<span class="hl opt">:</span> Ifthen<span class="hl opt">.</span>cpp
Guess<span class="hl opt">.</span>o<span class="hl opt">:</span> Guess<span class="hl opt">.</span>cpp
Guess2<span class="hl opt">.</span>o<span class="hl opt">:</span> Guess2<span class="hl opt">.</span>cpp
</pre>
      <p>
	La macro CPP contiene el nombre del compilador. Para usar un
	compilador diferente, puede editar el
	<code class="filename">makefile</code> o cambiar el valor de la macro
	desde línea de comandos, algo como:
      </p>
      <pre class="screen">
$ make CPP=cpp
</pre>
      <p>
	Tenga en cuenta, sin embargo, que
	<code class="filename">ExtractCode.cpp</code> tiene un esquema automático
	para construir <code class="filename">makefiles</code> para compiladores
	adicionales.
      </p>
      <p>
	La segunda macro <code class="varname">OFLAG</code> es la opción que se
	usa para indicar el nombre del fichero de salida. Aunque muchos
	compiladores asumen automáticamente que el fichero de salida
	tiene el mismo nombre base que el fichero de entrada, otros no
	(como los compiladores GNU/Unix, que por defecto crean un
	fichero llamado <code class="filename">a.out</code>).
      </p>
      <p>
	Como ve, hay dos reglas de sufijo, una para ficheros
	<code class="filename">.cpp</code> y otra para fichero
	<code class="filename">.c</code> (en caso de que se necesite compilar
	algún fuente C). El objetivo por defecto es
	<code class="literal">all</code>, y cada línea de este objetivo está
	«continuada» usando la contrabarra, hasta
	<code class="filename">Guess2</code>, que el el último de la lista y por
	eso no tiene contrabarra. Hay muchos más fichero en este
	capítulo, pero (por brevedad) sólo se muestran algunos.
      </p>
      <p>
	Las reglas de sufijo se ocupan de crear fichero objeto (con
	extensión <code class="filename">.o</code>) a partir de los fichero
	<code class="filename">.cpp</code>, pero en general se necesita escribir
	reglas explícitamente para crear el ejecutable, porque
	normalmente el ejecutable se crea enlazando muchos fichero
	objeto diferente y <span class="command"><strong>make</strong></span> no puede adivinar
	cuales son. También, en este caso (GNU/Unix) no se usan
	extensiones estándar para los ejecutables de modo que una regla
	de sufijo no sirve para esas situaciones. Por eso, verá que
	todas las reglas para construir el ejecutable final se indican
	explícitamente.
      </p>
      <p>
	Este <code class="filename">makefile</code> toma el camino más seguro
	usando el mínimo de prestaciones de <span class="command"><strong>make</strong></span>;
	sólo usa los conceptos básicos de objetivos y dependencias, y
	también macros. De este modo está prácticamente asegurado que
	funcionará con la mayoría de las implementaciones de
	<span class="command"><strong>make</strong></span>. Eso implica que se producen fichero
	<code class="filename">makefile</code> más grandes, pero no es algo
	negativo ya que se generan automáticamente por
	<code class="filename">ExtractCode.cpp</code>.

      </p>
      <p>
	Hay muchísimas otras prestaciones de <span class="command"><strong>make</strong></span> que
	no se usan en este libro, incluyendo las versiones más nuevas e
	inteligentes y las variaciones de <span class="command"><strong>make</strong></span> con
	atajos avanzados que permiten ahorrar mucho tiempo. La
	documentación propia de cada <span class="command"><strong>make</strong></span> particular
	describe en más profundidad sus características; puede aprender
	más sobre <span class="command"><strong>make</strong></span> en <em class="citetitle">Managing
	Projects with Make</em> de Oram y Taiboot (O'Reilly,
	1993). También, si el fabricante de su compilador no proporciona
	un <span class="command"><strong>make</strong></span> o usa uno que no es estándar, puede
	encontrar GNU Make para prácticamente todas las plataformas que
	existen buscado en los archivos de GNU en internet (hay muchos).
      </p>
    </div>
    <div class="navfooter">
      <hr />
      <table width="100%" summary="Navigation footer">
        <tr>
          <td class="navititle" width="1%">
            <a accesskey="p" href="ch03s11s02.html">
              <img src="./images/prev.png" alt="Anterior" />
            </a>
          </td>
          <td class="navititle" width="40%" align="left">
            <a accesskey="p" href="ch03s11s02.html">3.11.2. Los Makefiles de este libro</a>
          </td>
          <td width="10%" align="center">
            <a accesskey="u" href="ch03s11.html">
              <img src="./images/up.png" alt="Subir" />
            </a>
          </td>
          <td class="navititle" width="40%" align="right">
            <a accesskey="n" href="ch03s12.html">3.12. Resumen</a>
          </td>
          <td class="navititle" width="1%" align="right">
            <a accesskey="n" href="ch03s12.html">
              <img src="./images/next.png" alt="Siguiente" />
            </a>
          </td>
        </tr>
        <tr>
          <td valign="top"> </td>
          <td> </td>
          <td width="10%" align="center">
            <a accesskey="h" href="index.html">
              <img src="./images/home.png" alt="Inicio" />
            </a>
          </td>
          <td> </td>
          <td valign="top"> </td>
        </tr>
      </table>
    </div>
  </body>
</html>
