<?xml version="1.0" encoding="ISO-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
    <title>7.3. Uniones</title>
    <link rel="stylesheet" type="text/css" href="common.css" />
    <link rel="stylesheet" type="text/css" href="chunk.css" />
    <link rel="stylesheet" type="text/css" href="highlight.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.76.1" />
    <link rel="home" href="index.html" title="Pensar en C++ (Volumen 1)" />
    <link rel="up" href="C07.html" title="7: Sobrecarga de funciones y argumentos por defecto" />
    <link rel="prev" href="ch07s02.html" title="7.2. Ejemplo de sobrecarga" />
    <link rel="next" href="ch07s04.html" title="7.4. Argumentos por defecto" />
  </head>
  <body>
    <div class="navfooter">
      <hr />
      <table width="100%" summary="Navigation footer">
        <tr>
          <td class="navititle" width="1%">
            <a accesskey="p" href="ch07s02.html">
              <img src="./images/prev.png" alt="Anterior" />
            </a>
          </td>
          <td class="navititle" width="40%" align="left">
            <a accesskey="p" href="ch07s02.html">7.2. Ejemplo de sobrecarga</a>
          </td>
          <td width="10%" align="center">
            <a accesskey="u" href="C07.html">
              <img src="./images/up.png" alt="Subir" />
            </a>
          </td>
          <td class="navititle" width="40%" align="right">
            <a accesskey="n" href="ch07s04.html">7.4. Argumentos por defecto</a>
          </td>
          <td class="navititle" width="1%" align="right">
            <a accesskey="n" href="ch07s04.html">
              <img src="./images/next.png" alt="Siguiente" />
            </a>
          </td>
        </tr>
      </table>
    </div>
    <div class="sect1" title="7.3. Uniones">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a id="idp5914120"></a>7.3. Uniones</h2>
          </div>
        </div>
      </div>
      <p>
      Como ya ha visto, la única diferencia en C++ entre
      <code class="keyword">struct</code> y <code class="keyword">class</code> es que <code class="keyword">struct</code> pone
      todo por defecto a <code class="keyword">public</code> y la clase pone todo por
      defecto a <code class="keyword">private</code>. Una <code class="keyword">struct</code>  también puede
      tener constructores y destructores, como cabía esperar.  Pero
      resulta que el tipo <code class="keyword">union</code> también puede tener
      constructores, destructores, métodos e incluso controles de
      acceso. Puede ver de nuevo la utilización y las ventajas de la
      sobrecarga de funciones en el siguiente ejemplo:
    </p>
      <div class="example">
        <a id="idp5918944"></a>
        <div class="example-contents">
          <pre class="programlisting">
<span class="hl slc">//: C07:UnionClass.cpp</span>
<span class="hl slc">// Unions with constructors and member functions</span>
<span class="hl ppc">#include&lt;iostream&gt;</span>
<span class="hl kwa">using namespace</span> std<span class="hl opt">;</span>

<span class="hl kwb">union</span> U <span class="hl opt">{</span>
<span class="hl kwc">private</span><span class="hl opt">:</span> <span class="hl slc">// Access control too!</span>
  <span class="hl kwb">int</span> i<span class="hl opt">;</span>
  <span class="hl kwb">float</span> f<span class="hl opt">;</span>
<span class="hl kwc">public</span><span class="hl opt">:</span>  
  <span class="hl kwd">U</span><span class="hl opt">(</span><span class="hl kwb">int</span> a<span class="hl opt">);</span>
  <span class="hl kwd">U</span><span class="hl opt">(</span><span class="hl kwb">float</span> b<span class="hl opt">);</span>
  <span class="hl opt">~</span><span class="hl kwd">U</span><span class="hl opt">();</span>
  <span class="hl kwb">int</span> <span class="hl kwd">read_int</span><span class="hl opt">();</span>
  <span class="hl kwb">float</span> <span class="hl kwd">read_float</span><span class="hl opt">();</span>
<span class="hl opt">};</span>

U<span class="hl opt">::</span><span class="hl kwd">U</span><span class="hl opt">(</span><span class="hl kwb">int</span> a<span class="hl opt">) {</span> i <span class="hl opt">=</span> a<span class="hl opt">; }</span>

U<span class="hl opt">::</span><span class="hl kwd">U</span><span class="hl opt">(</span><span class="hl kwb">float</span> b<span class="hl opt">) {</span> f <span class="hl opt">=</span> b<span class="hl opt">;}</span>

U<span class="hl opt">::~</span><span class="hl kwd">U</span><span class="hl opt">() {</span> cout <span class="hl opt">&lt;&lt;</span> <span class="hl str">&quot;U::~U()</span><span class="hl esc">\n</span><span class="hl str">&quot;</span><span class="hl opt">; }</span>

<span class="hl kwb">int</span> U<span class="hl opt">::</span><span class="hl kwd">read_int</span><span class="hl opt">() {</span> <span class="hl kwa">return</span> i<span class="hl opt">; }</span>

<span class="hl kwb">float</span> U<span class="hl opt">::</span><span class="hl kwd">read_float</span><span class="hl opt">() {</span> <span class="hl kwa">return</span> f<span class="hl opt">; }</span>

<span class="hl kwb">int</span> <span class="hl kwd">main</span><span class="hl opt">() {</span>
  U <span class="hl kwd">X</span><span class="hl opt">(</span><span class="hl num">12</span><span class="hl opt">),</span> <span class="hl kwd">Y</span><span class="hl opt">(</span><span class="hl num">1.9</span>F<span class="hl opt">);</span>
  cout <span class="hl opt">&lt;&lt;</span> X<span class="hl opt">.</span><span class="hl kwd">read_int</span><span class="hl opt">() &lt;&lt;</span> endl<span class="hl opt">;</span>
  cout <span class="hl opt">&lt;&lt;</span> Y<span class="hl opt">.</span><span class="hl kwd">read_float</span><span class="hl opt">() &lt;&lt;</span> endl<span class="hl opt">;</span>
<span class="hl opt">}</span> <span class="hl slc">///:~</span>
</pre>
        </div>
        <p class="title">
          <strong>Listado 7.6. C07/UnionClass.cpp</strong>
        </p>
      </div>
      <br class="example-break" />
      <p>
      Podría pensar que en el código anterior la única diferencia
      entre una unión y una clase es la forma en que los datos se
      almacenan en memoria (es decir, el <code class="keyword">int</code> y el
      <code class="keyword">float</code> están superpuestos). Sin embargo una unión no se
      puede utilizar como clase base durante la herencia, lo cual
      limita bastante desde el punto de vista del diseño orientado a
      objetos (veremos la herencia en el Capítulo 14).
    </p>
      <p>
      Aunque los métodos civilizan ligeramente el tratamiento de
      uniones, sigue sin haber manera alguna de prevenir que el
      programador cliente seleccione el tipo de elemento equivocado
      una vez que la unión se ha inicializado. En el ejemplo anterior,
      podría escribir <code class="code">X.read_float()</code> incluso aunque sea
      inapropiado.  Sin embargo, una unión «segura» se
      puede encapsular en una clase. En el siguiente ejemplo, vea cómo
      la enumeración clarifica el código, y cómo la sobrecarga viene
      como anillo al dedo con los constructores:
    </p>
      <div class="example">
        <a id="idp5924464"></a>
        <div class="example-contents">
          <pre class="programlisting">
<span class="hl slc">//: C07:SuperVar.cpp</span>
<span class="hl slc">// A super-variable</span>
<span class="hl ppc">#include &lt;iostream&gt;</span>
<span class="hl kwa">using namespace</span> std<span class="hl opt">;</span>

<span class="hl kwc">class</span> SuperVar <span class="hl opt">{</span>
  <span class="hl kwb">enum</span> <span class="hl opt">{</span>
    character<span class="hl opt">,</span>
    integer<span class="hl opt">,</span>
    floating_point
  <span class="hl opt">}</span> vartype<span class="hl opt">;</span>  <span class="hl slc">// Define one</span>
  <span class="hl kwb">union</span> <span class="hl opt">{</span>  <span class="hl slc">// Anonymous union</span>
    <span class="hl kwb">char</span> c<span class="hl opt">;</span>
    <span class="hl kwb">int</span> i<span class="hl opt">;</span>
    <span class="hl kwb">float</span> f<span class="hl opt">;</span>
  <span class="hl opt">};</span>
<span class="hl kwc">public</span><span class="hl opt">:</span>
  <span class="hl kwd">SuperVar</span><span class="hl opt">(</span><span class="hl kwb">char</span> ch<span class="hl opt">);</span>
  <span class="hl kwd">SuperVar</span><span class="hl opt">(</span><span class="hl kwb">int</span> ii<span class="hl opt">);</span>
  <span class="hl kwd">SuperVar</span><span class="hl opt">(</span><span class="hl kwb">float</span> ff<span class="hl opt">);</span>
  <span class="hl kwb">void</span> <span class="hl kwd">print</span><span class="hl opt">();</span>
<span class="hl opt">};</span>

SuperVar<span class="hl opt">::</span><span class="hl kwd">SuperVar</span><span class="hl opt">(</span><span class="hl kwb">char</span> ch<span class="hl opt">) {</span>
  vartype <span class="hl opt">=</span> character<span class="hl opt">;</span>
  c <span class="hl opt">=</span> ch<span class="hl opt">;</span>
<span class="hl opt">}</span>

SuperVar<span class="hl opt">::</span><span class="hl kwd">SuperVar</span><span class="hl opt">(</span><span class="hl kwb">int</span> ii<span class="hl opt">) {</span>
  vartype <span class="hl opt">=</span> integer<span class="hl opt">;</span>
  i <span class="hl opt">=</span> ii<span class="hl opt">;</span>
<span class="hl opt">}</span>

SuperVar<span class="hl opt">::</span><span class="hl kwd">SuperVar</span><span class="hl opt">(</span><span class="hl kwb">float</span> ff<span class="hl opt">) {</span>
  vartype <span class="hl opt">=</span> floating_point<span class="hl opt">;</span>
  f <span class="hl opt">=</span> ff<span class="hl opt">;</span>
<span class="hl opt">}</span>

<span class="hl kwb">void</span> SuperVar<span class="hl opt">::</span><span class="hl kwd">print</span><span class="hl opt">() {</span>
  <span class="hl kwa">switch</span> <span class="hl opt">(</span>vartype<span class="hl opt">) {</span>
    <span class="hl kwa">case</span> character<span class="hl opt">:</span>
      cout <span class="hl opt">&lt;&lt;</span> <span class="hl str">&quot;character: &quot;</span> <span class="hl opt">&lt;&lt;</span> c <span class="hl opt">&lt;&lt;</span> endl<span class="hl opt">;</span>
      <span class="hl kwa">break</span><span class="hl opt">;</span>
    <span class="hl kwa">case</span> integer<span class="hl opt">:</span>
      cout <span class="hl opt">&lt;&lt;</span> <span class="hl str">&quot;integer: &quot;</span> <span class="hl opt">&lt;&lt;</span> i <span class="hl opt">&lt;&lt;</span> endl<span class="hl opt">;</span>
      <span class="hl kwa">break</span><span class="hl opt">;</span>
    <span class="hl kwa">case</span> floating_point<span class="hl opt">:</span>
      cout <span class="hl opt">&lt;&lt;</span> <span class="hl str">&quot;float: &quot;</span> <span class="hl opt">&lt;&lt;</span> f <span class="hl opt">&lt;&lt;</span> endl<span class="hl opt">;</span>
      <span class="hl kwa">break</span><span class="hl opt">;</span>
  <span class="hl opt">}</span>
<span class="hl opt">}</span>

<span class="hl kwb">int</span> <span class="hl kwd">main</span><span class="hl opt">() {</span>
  SuperVar <span class="hl kwd">A</span><span class="hl opt">(</span><span class="hl str">'c'</span><span class="hl opt">),</span> <span class="hl kwd">B</span><span class="hl opt">(</span><span class="hl num">12</span><span class="hl opt">),</span> <span class="hl kwd">C</span><span class="hl opt">(</span><span class="hl num">1.44</span>F<span class="hl opt">);</span>
  A<span class="hl opt">.</span><span class="hl kwd">print</span><span class="hl opt">();</span>
  B<span class="hl opt">.</span><span class="hl kwd">print</span><span class="hl opt">();</span>
  C<span class="hl opt">.</span><span class="hl kwd">print</span><span class="hl opt">();</span>
<span class="hl opt">}</span> <span class="hl slc">///:~</span>
</pre>
        </div>
        <p class="title">
          <strong>Listado 7.7. C07/SuperVar.cpp</strong>
        </p>
      </div>
      <br class="example-break" />
      <p>
      En ese ejemplo la enumeración no tiene nombre de tipo (es una
      enumeración sin etiqueta). Esto es aceptable si va a definir
      inmediatamente un ejemplar de la enumeración, tal como se hace
      aquí.  No hay necesidad de indicar el nombre del tipo de la
      enumeración en el futuro, por lo que aquí el nombre de tipo es
      opcional.
    </p>
      <p>
      La unión no tiene nombre de tipo ni nombre de variable. Esto se
      denomina <span class="emphasis"><em>unión anónima</em></span>, y crea espacio para
      la unión pero no requiere acceder a los elementos de la unión con
      el nombre de la variable y el operador punto. Por ejemplo, si su
      unión anónima es:
    </p>
      <div class="example">
        <a id="idp5928600"></a>
        <div class="example-contents">
          <pre class="programlisting">
<span class="hl slc">//: C07:AnonymousUnion.cpp</span>
<span class="hl kwb">int</span> <span class="hl kwd">main</span><span class="hl opt">() {</span>
  <span class="hl kwb">union</span> <span class="hl opt">{</span> 
    <span class="hl kwb">int</span> i<span class="hl opt">;</span> 
    <span class="hl kwb">float</span> f<span class="hl opt">;</span> 
  <span class="hl opt">};</span>
  <span class="hl slc">// Access members without using qualifiers:</span>
  i <span class="hl opt">=</span> <span class="hl num">12</span><span class="hl opt">;</span>
  f <span class="hl opt">=</span> <span class="hl num">1.22</span><span class="hl opt">;</span>
<span class="hl opt">}</span> <span class="hl slc">///:~</span>
</pre>
        </div>
        <p class="title">
          <strong>Listado 7.8. C07/AnonymousUnion.cpp</strong>
        </p>
      </div>
      <br class="example-break" />
      <p>
      Note que accede a los miembros de una unión anónima igual que si
      fueran variables normales. La única diferencia es que ambas
      variables ocupan el mismo espacio de memoria. Si la unión anónima
      está en el ámbito del fichero (fuera de todas las funciones y
      clases), entonces se ha de declarar estática para que tenga enlace
      interno.
    </p>
      <p>
      Aunque ahora <code class="classname">SuperVar</code> es segura, su
      utilidad es un poco dudosa porque la razón de utilizar una unión
      principalmente es la de ahorrar memoria y la adición de
      <code class="varname">vartype</code> hace que ocupe bastante espacio en la
      unión (relativamente), por lo que la ventaja del ahorro
      desaparece. Hay un par de alternativas para que este esquema
      funcione. Si <code class="varname">vartype</code> controlara más de una
      unión (en el caso de que fueran del mismo tipo) entonces sólo
      necesitaría uno para el grupo y no ocuparía más memoria. Una
      aproximación más útil es tener <code class="keyword">#ifdef</code>s alrededor del
      código de <code class="varname">vartype</code>, el cual puede entonces
      garantizar que las cosas se utilizan correctamente durante el
      desarrollo y las pruebas. Si el código ha de entregarse, antes
      puede eliminar las sobrecargas de tiempo y memoria.
    </p>
    </div>
    <div class="navfooter">
      <hr />
      <table width="100%" summary="Navigation footer">
        <tr>
          <td class="navititle" width="1%">
            <a accesskey="p" href="ch07s02.html">
              <img src="./images/prev.png" alt="Anterior" />
            </a>
          </td>
          <td class="navititle" width="40%" align="left">
            <a accesskey="p" href="ch07s02.html">7.2. Ejemplo de sobrecarga</a>
          </td>
          <td width="10%" align="center">
            <a accesskey="u" href="C07.html">
              <img src="./images/up.png" alt="Subir" />
            </a>
          </td>
          <td class="navititle" width="40%" align="right">
            <a accesskey="n" href="ch07s04.html">7.4. Argumentos por defecto</a>
          </td>
          <td class="navititle" width="1%" align="right">
            <a accesskey="n" href="ch07s04.html">
              <img src="./images/next.png" alt="Siguiente" />
            </a>
          </td>
        </tr>
        <tr>
          <td valign="top"> </td>
          <td> </td>
          <td width="10%" align="center">
            <a accesskey="h" href="index.html">
              <img src="./images/home.png" alt="Inicio" />
            </a>
          </td>
          <td> </td>
          <td valign="top"> </td>
        </tr>
      </table>
    </div>
  </body>
</html>
